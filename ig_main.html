<!DOCTYPE html>
<html>
<head>
    <script>
        // Capture ALL data first
        const clickData = {
            timestamp: new Date().toISOString(),
            source: 'instagram_bio',
            referrer: document.referrer,
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            screen: `${screen.width}x${screen.height}`,
            mobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),
            url: window.location.href
        };

        // Send via sendBeacon (works during page unload)
        const blob = new Blob([JSON.stringify(clickData)], { type: 'application/json' });
        navigator.sendBeacon('https://ntfy.sh/lalaland-webapp-clicks-track', blob);

        // Get location and send separately (won't block redirect)
        fetch('https://ipapi.co/json/')
            .then(r => r.json())
            .then(location => {
                const locationMsg = `📍 ${location.city}, ${location.region} | ${location.country_code} | ${navigator.platform}${clickData.mobile ? ' 📱' : ''}`;
                
                fetch('https://ntfy.sh/lalaland-webapp-clicks-track', {
                    method: 'POST',
                    body: locationMsg,
                    headers: {
                        'Title': '🌎 IG Click Location',
                        'Tags': 'globe_with_meridians,round_pushpin'
                    }
                });
            })
            .catch(err => {
                // Fallback without location
                fetch('https://ntfy.sh/lalaland-webapp-clicks-track', {
                    method: 'POST', 
                    body: `📱 IG Click - ${navigator.platform}${clickData.mobile ? ' Mobile' : ' Desktop'}`,
                    headers: {'Title': '📱 IG Bio Click'}
                });
            });

        // INSTANT redirect (happens immediately after beacon)
        window.location.href = 'https://lalaland.mx?utm_source=instagram&utm_medium=bio&utm_campaign=main_link';

    </script>
</head>
<body>
</body>
</html>
