<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Modal Designer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .designer-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            height: calc(100vh - 40px);
        }

        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 600px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0 20px;
            grid-template-areas:
                "title title"
                "sections sections"
                "templates size"
                "radius radius"
                "export export";
        }

        .control-panel h2 {
            margin-bottom: 24px;
            color: #333;
            font-size: 24px;
            grid-area: title;
        }

        .control-section {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e0e0e0;
        }

        .control-section:last-child {
            border-bottom: none;
        }

        .control-section:nth-of-type(1) {
            grid-area: sections;
        }

        .control-section:nth-of-type(2) {
            grid-area: templates;
        }

        .control-section:nth-of-type(3) {
            grid-area: size;
        }

        .control-section:nth-of-type(4) {
            grid-area: radius;
        }

        .control-section:nth-of-type(5) {
            grid-area: export;
        }

        .control-section h3 {
            margin-bottom: 16px;
            color: #555;
            font-size: 16px;
            font-weight: 600;
        }

        .section-controls {
            max-height: 250px;
            overflow-y: auto;
        }

        .section-control {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .section-control.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .section-control:hover {
            background: #f0f0f0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .section-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .btn-remove {
            background: #ff4757;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .btn-remove:hover {
            background: #ff3838;
        }

        .height-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .height-control label {
            font-size: 12px;
            color: #666;
            min-width: 50px;
        }

        .height-control input[type="range"] {
            flex: 1;
            height: 6px;
        }

        .height-control input[type="number"] {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .btn-add-section {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .btn-add-section:hover {
            background: #5568d3;
        }

        .content-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 8px;
        }

        .content-templates button {
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .content-templates button:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .size-display {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            font-family: monospace;
            font-size: 14px;
            color: #333;
        }

        .control-section:nth-of-type(5) {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }

        .control-section:nth-of-type(5) button {
            width: 100%;
            padding: 10px;
            margin-bottom: 0;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .control-section:nth-of-type(5) h3 {
            grid-column: 1 / -1;
        }

        .control-section:nth-of-type(5) button:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Preview Area */
        .preview-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .device-frame {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .modal-preview {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 400px;
            height: 600px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-sections {
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-section {
            border-bottom: 1px dashed #e0e0e0;
            padding: 16px;
            position: relative;
            min-height: 50px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            flex-direction: column;
        }

        .modal-section:hover {
            background: #f8f9fa;
        }

        .modal-section.selected {
            background: #f0f3ff;
            border-left: 4px solid #667eea;
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent calc((100% / var(--columns)) - 1px),
                rgba(102, 126, 234, 0.1) calc((100% / var(--columns)) - 1px),
                rgba(102, 126, 234, 0.1) calc(100% / var(--columns))
            );
        }

        .modal-section:last-child {
            border-bottom: none;
        }

        .section-label {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            pointer-events: none;
            z-index: 5;
        }

        /* Content Elements */
        .dummy-text {
            color: #666;
            line-height: 1.5;
        }

        .dummy-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            align-self: flex-start;
            transition: background 0.2s;
        }

        .dummy-button:hover {
            background: #5568d3;
        }

        .dummy-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .dummy-image {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #e0e0e0 0%, #f0f0f0 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        /* Resize Handle */
        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            cursor: nwse-resize;
            background: linear-gradient(135deg, transparent 50%, #667eea 50%);
            border-bottom-right-radius: 12px;
        }

        .resize-handle:hover {
            background: linear-gradient(135deg, transparent 50%, #764ba2 50%);
        }

        /* Export Modal */
        .export-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .export-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .export-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .close-export {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close-export:hover {
            color: #000;
        }

        .export-content h3 {
            margin-bottom: 16px;
            color: #333;
        }

        .export-content textarea {
            width: 100%;
            height: 400px;
            padding: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            margin-bottom: 16px;
        }

        .export-content button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .export-content button:hover {
            background: #5568d3;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .designer-container {
                flex-direction: column;
            }

            .control-panel {
                width: 100%;
                max-height: none;
                grid-template-areas:
                    "title title"
                    "sections sections"
                    "templates size"
                    "radius export";
            }

            .preview-area {
                min-height: 600px;
            }
        }
    </style>
</head>
<body>
    <div class="designer-container">
        <!-- Control Panel -->
        <div class="control-panel">
            <h2>Modal Designer</h2>

            <div class="control-section">
                <h3>Sections <span id="totalHeight" style="float: right; font-size: 14px; color: #667eea;">(100%)</span></h3>
                <div class="section-controls" id="sectionControls">
                    <!-- Section controls will be generated here -->
                </div>
                <button class="btn-add-section" onclick="addSection()">+ Add Section</button>
                <button class="btn-add-section" onclick="equalizeAllSections()" style="background: #28a745; margin-top: 8px;">âš– Equalize All</button>
            </div>

            <div class="control-section">
                <h3>Add Content</h3>
                <div class="content-templates">
                    <button onclick="addContent('text')">Text</button>
                    <button onclick="addContent('button')">Button</button>
                    <button onclick="addContent('input')">Input</button>
                    <button onclick="addContent('image')">Image</button>
                </div>
                <div style="margin-top: 12px; padding: 8px; background: #f0f3ff; border-radius: 6px; font-size: 12px; color: #667eea;">
                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 4px;">
                        <label>Columns:</label>
                        <input type="number" id="sectionColumns" min="1" max="12" value="1"
                               style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px;"
                               onchange="updateSectionColumns()">
                        <label>Span:</label>
                        <input type="number" id="contentSpan" min="1" max="12" value="1"
                               style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="font-size: 11px; opacity: 0.8;">Select section first, then add content</div>
                </div>
            </div>

            <div class="control-section">
                <h3>Modal Size</h3>
                <div class="size-display">
                    <span id="modalWidth">400</span>px Ã— <span id="modalHeight">600</span>px
                </div>
            </div>

            <div class="control-section">
                <h3>Border Radius</h3>
                <div class="height-control">
                    <label>Radius:</label>
                    <input type="range"
                           id="radiusSlider"
                           min="0"
                           max="50"
                           step="1"
                           value="12"
                           oninput="updateBorderRadius(this.value); document.getElementById('radiusValue').value = this.value">
                    <input type="number"
                           id="radiusValue"
                           min="0"
                           max="50"
                           step="1"
                           value="12"
                           oninput="updateBorderRadius(this.value); document.getElementById('radiusSlider').value = this.value"
                           style="width: 60px; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                </div>
            </div>

            <div class="control-section">
                <h3>Export</h3>
                <button onclick="exportHTML()">Export HTML</button>
                <button onclick="exportCSS()">Export CSS</button>
                <button onclick="resetModal()">Reset</button>
            </div>
        </div>

        <!-- Preview Area -->
        <div class="preview-area">
            <div class="device-frame">
                <div class="modal-preview" id="modalPreview">
                    <div class="modal-sections" id="modalSections">
                        <!-- Sections will be dynamically added here -->
                    </div>

                    <div class="resize-handle" title="Drag to resize"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="export-modal">
        <div class="export-content">
            <span class="close-export" onclick="closeExportModal()">&times;</span>
            <h3 id="exportTitle">Export Code</h3>
            <textarea id="exportCode" readonly></textarea>
            <button onclick="copyExportCode()">Copy to Clipboard</button>
        </div>
    </div>

    <script>
        // Modal Designer State
        let sections = [];
        let selectedSectionId = null;
        let modalWidth = 400;
        let modalHeight = 600;
        let modalTitle = 'Modal Designer';
        let modalBorderRadius = 12;

        // Initialize with default sections
        function init() {
            // Add default sections
            const defaultSections = ['Header', 'Line 1', 'Line 2', 'Line 3', 'Line 4', 'Line 5', 'Line 6', 'Line 7', 'Line 8'];

            defaultSections.forEach((name, index) => {
                const heightPercent = index === 0 ? 10 : 11.25; // Header 10%, others split remaining 90%
                sections.push({
                    id: Date.now() + index,
                    name: name,
                    height: heightPercent,
                    columns: 1,
                    content: []
                });
            });

            normalizeHeights(); // Ensure sections sum to 100%
            renderSections();
            renderControls();
            setupDragAndResize();
        }

        // Add new section
        function addSection() {
            const sectionNumber = sections.length + 1;

            // Calculate space to take from existing sections
            const targetHeight = 10;
            const otherSections = sections;

            if (otherSections.length > 0) {
                const totalOtherHeight = otherSections.reduce((sum, s) => sum + s.height, 0);
                const remainingSpace = 100 - targetHeight;

                // Shrink existing sections proportionally
                otherSections.forEach(s => {
                    const proportion = s.height / totalOtherHeight;
                    s.height = remainingSpace * proportion;
                });
            }

            const newSection = {
                id: Date.now(),
                name: `Line ${sectionNumber}`,
                height: targetHeight,
                columns: 1,
                content: []
            };

            sections.push(newSection);
            normalizeHeights();
            renderSections();
            renderControls();
        }

        // Remove section
        function removeSection(id) {
            const removedSection = sections.find(s => s.id === id);
            if (!removedSection) return;

            const removedHeight = removedSection.height;
            sections = sections.filter(s => s.id !== id);

            if (selectedSectionId === id) {
                selectedSectionId = null;
            }

            // Redistribute the removed section's height to remaining sections
            if (sections.length > 0) {
                const totalRemainingHeight = sections.reduce((sum, s) => sum + s.height, 0);
                if (totalRemainingHeight > 0) {
                    sections.forEach(s => {
                        const proportion = s.height / totalRemainingHeight;
                        s.height += removedHeight * proportion;
                    });
                } else {
                    const equalHeight = 100 / sections.length;
                    sections.forEach(s => s.height = equalHeight);
                }
            }

            normalizeHeights();
            renderSections();
            renderControls();
        }

        // Update section height and redistribute others
        function updateSectionHeight(id, height) {
            const newHeight = parseFloat(height);
            const section = sections.find(s => s.id === id);
            if (!section) return;

            const oldHeight = section.height;
            const difference = newHeight - oldHeight;

            // Get other sections
            const otherSections = sections.filter(s => s.id !== id);

            if (otherSections.length === 0) {
                section.height = 100;
                renderSections();
                renderControls();
                return;
            }

            // Calculate total height of other sections
            const othersTotalHeight = otherSections.reduce((sum, s) => sum + s.height, 0);

            // If new height would exceed 100%, cap it
            if (newHeight > 100) {
                section.height = 100;
                otherSections.forEach(s => s.height = 0);
            } else {
                section.height = newHeight;

                // Distribute the difference among other sections proportionally
                if (othersTotalHeight > 0) {
                    const remainingSpace = 100 - newHeight;
                    otherSections.forEach(s => {
                        const proportion = s.height / othersTotalHeight;
                        s.height = remainingSpace * proportion;
                    });
                } else {
                    // If others were 0, distribute equally
                    const equalHeight = (100 - newHeight) / otherSections.length;
                    otherSections.forEach(s => s.height = equalHeight);
                }
            }

            // Ensure minimum heights and normalize to 100%
            normalizeHeights();
            renderSections();
            renderControls();
        }

        // Normalize all section heights to sum to 100%
        function normalizeHeights() {
            const total = sections.reduce((sum, s) => sum + s.height, 0);
            if (total > 0 && Math.abs(total - 100) > 0.01) {
                sections.forEach(s => {
                    s.height = (s.height / total) * 100;
                });
            }
        }

        // Get total height
        function getTotalHeight() {
            return sections.reduce((sum, s) => sum + s.height, 0);
        }

        // Equalize all sections to same height
        function equalizeAllSections() {
            if (sections.length === 0) return;

            const equalHeight = 100 / sections.length;
            sections.forEach(s => {
                s.height = equalHeight;
            });

            renderSections();
            renderControls();
        }

        // Rename section
        function renameSection(id, newName) {
            const section = sections.find(s => s.id === id);
            if (section) {
                section.name = newName || section.name;
                renderSections();
                renderControls();
            }
        }

        // Update modal title
        function updateModalTitle(newTitle) {
            modalTitle = newTitle || 'Modal Designer';
            const titleEl = document.getElementById('modalTitleDisplay');
            if (titleEl) {
                titleEl.textContent = modalTitle;
            }
        }

        // Update border radius
        function updateBorderRadius(radius) {
            modalBorderRadius = parseInt(radius);
            const modal = document.getElementById('modalPreview');
            if (modal) {
                modal.style.borderRadius = modalBorderRadius + 'px';
            }
        }

        // Select section
        function selectSection(id) {
            selectedSectionId = id;
            const section = sections.find(s => s.id === id);
            if (section) {
                document.getElementById('sectionColumns').value = section.columns;
            }
            renderSections();
            renderControls();
        }

        // Update section columns
        function updateSectionColumns() {
            if (!selectedSectionId) {
                alert('Please select a section first!');
                return;
            }

            const section = sections.find(s => s.id === selectedSectionId);
            if (!section) return;

            const columns = parseInt(document.getElementById('sectionColumns').value);
            section.columns = Math.max(1, Math.min(12, columns));
            renderSections();
        }

        // Add content to selected section
        function addContent(type) {
            if (!selectedSectionId) {
                alert('Please select a section first!');
                return;
            }

            const section = sections.find(s => s.id === selectedSectionId);
            if (!section) return;

            const span = parseInt(document.getElementById('contentSpan').value) || 1;

            const content = {
                id: Date.now(),
                type: type,
                span: Math.min(span, section.columns)
            };

            section.content.push(content);
            renderSections();
        }

        // Render sections in modal
        function renderSections() {
            const container = document.getElementById('modalSections');
            container.innerHTML = '';

            sections.forEach((section, index) => {
                const sectionEl = document.createElement('div');
                sectionEl.className = 'modal-section';
                sectionEl.style.height = `${section.height}%`;
                sectionEl.style.setProperty('--columns', section.columns);

                if (section.id === selectedSectionId) {
                    sectionEl.classList.add('selected');
                }

                // Add drag handle to first section
                if (index === 0) {
                    sectionEl.classList.add('first-section');
                    sectionEl.style.cursor = 'move';

                    const dragHandle = document.createElement('button');
                    dragHandle.className = 'modal-drag-handle';
                    dragHandle.textContent = 'â‹®â‹®';
                    dragHandle.title = 'Drag to move';
                    dragHandle.style.cssText = 'position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.1); border: none; color: #666; padding: 4px 8px; border-radius: 4px; cursor: move; font-size: 16px; z-index: 10;';
                    sectionEl.appendChild(dragHandle);
                }

                sectionEl.onclick = (e) => {
                    e.stopPropagation();
                    selectSection(section.id);
                };

                // Add label
                const label = document.createElement('div');
                label.className = 'section-label';
                label.textContent = `${section.name} (${section.height.toFixed(1)}%) [${section.columns} col]`;
                sectionEl.appendChild(label);

                // Create grid container for content
                if (section.content.length > 0) {
                    const gridContainer = document.createElement('div');
                    gridContainer.style.cssText = `
                        display: grid;
                        grid-template-columns: repeat(${section.columns}, 1fr);
                        gap: 8px;
                        width: 100%;
                        height: calc(100% - 30px);
                    `;

                    // Render content
                    section.content.forEach(item => {
                        const contentEl = createContentElement(item, section.id);
                        contentEl.style.gridColumn = `span ${item.span || 1}`;
                        gridContainer.appendChild(contentEl);
                    });

                    sectionEl.appendChild(gridContainer);
                }

                container.appendChild(sectionEl);
            });

            // Click outside to deselect
            container.onclick = () => {
                selectedSectionId = null;
                renderSections();
                renderControls();
            };
        }

        // Remove content item
        function removeContent(sectionId, contentId) {
            const section = sections.find(s => s.id === sectionId);
            if (section) {
                section.content = section.content.filter(c => c.id !== contentId);
                renderSections();
            }
        }

        // Create content element
        function createContentElement(item, sectionId) {
            const wrapper = document.createElement('div');
            wrapper.style.cssText = 'position: relative; display: flex; flex-direction: column; gap: 4px; min-height: 40px; background: rgba(255,255,255,0.5); border: 1px dashed #ddd; border-radius: 4px; padding: 8px;';

            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Ã—';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removeContent(sectionId, item.id);
            };
            removeBtn.style.cssText = 'position: absolute; top: 2px; right: 2px; background: #ff4757; color: white; border: none; width: 18px; height: 18px; border-radius: 3px; cursor: pointer; font-size: 14px; line-height: 1; padding: 0; z-index: 10;';

            const spanLabel = document.createElement('div');
            spanLabel.textContent = `Span: ${item.span}`;
            spanLabel.style.cssText = 'position: absolute; top: 2px; left: 4px; font-size: 10px; color: #999; font-weight: 600;';

            wrapper.appendChild(removeBtn);
            wrapper.appendChild(spanLabel);

            const el = document.createElement('div');
            el.style.cssText = 'margin-top: 14px;';

            switch (item.type) {
                case 'text':
                    el.className = 'dummy-text';
                    el.textContent = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.';
                    break;
                case 'button':
                    const btn = document.createElement('button');
                    btn.className = 'dummy-button';
                    btn.textContent = 'Click Me';
                    el.appendChild(btn);
                    break;
                case 'input':
                    const input = document.createElement('input');
                    input.className = 'dummy-input';
                    input.type = 'text';
                    input.placeholder = 'Enter text...';
                    el.appendChild(input);
                    break;
                case 'image':
                    const img = document.createElement('div');
                    img.className = 'dummy-image';
                    img.textContent = 'ðŸ–¼ï¸ Image';
                    el.appendChild(img);
                    break;
            }

            wrapper.appendChild(el);
            return wrapper;
        }

        // Render controls panel
        function renderControls() {
            const container = document.getElementById('sectionControls');
            container.innerHTML = '';

            sections.forEach(section => {
                const controlEl = document.createElement('div');
                controlEl.className = 'section-control';

                if (section.id === selectedSectionId) {
                    controlEl.classList.add('selected');
                }

                controlEl.innerHTML = `
                    <div class="section-header">
                        <input type="text"
                               class="section-name-input"
                               value="${section.name}"
                               onchange="renameSection(${section.id}, this.value)"
                               onclick="event.stopPropagation()"
                               style="flex: 1; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-weight: 600;">
                        <button class="btn-remove" onclick="removeSection(${section.id})">Remove</button>
                    </div>
                    <div class="height-control">
                        <label>Height:</label>
                        <input type="range"
                               min="1"
                               max="80"
                               step="0.5"
                               value="${section.height.toFixed(1)}"
                               oninput="updateSectionHeight(${section.id}, this.value); this.nextElementSibling.value = this.value">
                        <input type="number"
                               min="1"
                               max="80"
                               step="0.5"
                               value="${section.height.toFixed(1)}"
                               oninput="updateSectionHeight(${section.id}, this.value); this.previousElementSibling.value = this.value">
                    </div>
                `;

                controlEl.onclick = () => selectSection(section.id);

                container.appendChild(controlEl);
            });

            // Update total height display
            const total = getTotalHeight();
            const totalEl = document.getElementById('totalHeight');
            if (totalEl) {
                totalEl.textContent = `(${total.toFixed(1)}%)`;
                totalEl.style.color = Math.abs(total - 100) < 0.1 ? '#667eea' : '#ff4757';
            }
        }

        // Setup drag and resize functionality
        function setupDragAndResize() {
            const modal = document.getElementById('modalPreview');
            const resizeHandle = modal.querySelector('.resize-handle');

            // Dragging
            let isDragging = false;
            let currentX, currentY, initialX, initialY;

            document.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            function dragStart(e) {
                // Check if click is on drag handle or first section
                const dragHandle = e.target.closest('.modal-drag-handle');
                const firstSection = e.target.closest('.first-section');

                if (dragHandle || (firstSection && !e.target.closest('input, button:not(.modal-drag-handle)'))) {
                    initialX = e.clientX - modal.offsetLeft;
                    initialY = e.clientY - modal.offsetTop;
                    isDragging = true;
                    e.preventDefault();
                }
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;

                    modal.style.left = currentX + 'px';
                    modal.style.top = currentY + 'px';
                    modal.style.transform = 'none';
                }
            }

            function dragEnd() {
                isDragging = false;
            }

            // Resizing
            let isResizing = false;
            let originalWidth, originalHeight, originalMouseX, originalMouseY;

            resizeHandle.addEventListener('mousedown', resizeStart);
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', resizeEnd);

            function resizeStart(e) {
                isResizing = true;
                originalWidth = modal.offsetWidth;
                originalHeight = modal.offsetHeight;
                originalMouseX = e.clientX;
                originalMouseY = e.clientY;
                e.preventDefault();
            }

            function resize(e) {
                if (isResizing) {
                    const width = originalWidth + (e.clientX - originalMouseX);
                    const height = originalHeight + (e.clientY - originalMouseY);

                    modal.style.width = width + 'px';
                    modalWidth = width;
                    modal.style.height = height + 'px';
                    modalHeight = height;

                    updateSizeDisplay();
                }
            }

            function resizeEnd() {
                isResizing = false;
            }
        }

        // Update size display
        function updateSizeDisplay() {
            document.getElementById('modalWidth').textContent = Math.round(modalWidth);
            document.getElementById('modalHeight').textContent = Math.round(modalHeight);
        }

        // Export HTML
        function exportHTML() {
            let html = `<div class="modal-container">\n`;
            html += `  <div class="modal-header">\n`;
            html += `    <span class="modal-title">${modalTitle}</span>\n`;
            html += `    <button class="modal-close">Ã—</button>\n`;
            html += `  </div>\n`;
            html += `  <div class="modal-body">\n`;

            sections.forEach(section => {
                html += `    <div class="modal-section" data-height="${section.height}%">\n`;
                html += `      <!-- ${section.name} -->\n`;

                section.content.forEach(item => {
                    switch (item.type) {
                        case 'text':
                            html += `      <p>Lorem ipsum dolor sit amet...</p>\n`;
                            break;
                        case 'button':
                            html += `      <button>Click Me</button>\n`;
                            break;
                        case 'input':
                            html += `      <input type="text" placeholder="Enter text...">\n`;
                            break;
                        case 'image':
                            html += `      <img src="placeholder.jpg" alt="Placeholder">\n`;
                            break;
                    }
                });

                html += `    </div>\n`;
            });

            html += `  </div>\n`;
            html += `</div>`;

            showExportModal('Export HTML', html);
        }

        // Export CSS
        function exportCSS() {
            let css = `.modal-container {\n`;
            css += `  width: ${modalWidth}px;\n`;
            css += `  height: ${modalHeight}px;\n`;
            css += `  background: white;\n`;
            css += `  border-radius: 12px;\n`;
            css += `  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n`;
            css += `  display: flex;\n`;
            css += `  flex-direction: column;\n`;
            css += `  overflow: hidden;\n`;
            css += `}\n\n`;

            css += `.modal-header {\n`;
            css += `  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n`;
            css += `  color: white;\n`;
            css += `  padding: 16px 20px;\n`;
            css += `  display: flex;\n`;
            css += `  justify-content: space-between;\n`;
            css += `  align-items: center;\n`;
            css += `}\n\n`;

            css += `.modal-body {\n`;
            css += `  flex: 1;\n`;
            css += `  display: flex;\n`;
            css += `  flex-direction: column;\n`;
            css += `  overflow-y: auto;\n`;
            css += `}\n\n`;

            sections.forEach((section, index) => {
                css += `.modal-section:nth-child(${index + 1}) {\n`;
                css += `  height: ${section.height}%;\n`;
                css += `  padding: 16px;\n`;
                css += `  border-bottom: 1px solid #e0e0e0;\n`;
                css += `}\n\n`;
            });

            showExportModal('Export CSS', css);
        }

        // Show export modal
        function showExportModal(title, code) {
            const modal = document.getElementById('exportModal');
            const titleEl = document.getElementById('exportTitle');
            const codeEl = document.getElementById('exportCode');

            titleEl.textContent = title;
            codeEl.value = code;
            modal.classList.add('active');
        }

        // Close export modal
        function closeExportModal() {
            const modal = document.getElementById('exportModal');
            modal.classList.remove('active');
        }

        // Copy export code
        function copyExportCode() {
            const codeEl = document.getElementById('exportCode');
            codeEl.select();
            document.execCommand('copy');
            alert('Code copied to clipboard!');
        }

        // Reset modal
        function resetModal() {
            if (confirm('Are you sure you want to reset the modal? This will clear all sections and content.')) {
                sections = [];
                selectedSectionId = null;

                const modal = document.getElementById('modalPreview');
                modal.style.width = '400px';
                modal.style.height = '600px';
                modal.style.left = '50%';
                modal.style.top = '50%';
                modal.style.transform = 'translate(-50%, -50%)';
                modal.style.borderRadius = '12px';

                modalWidth = 400;
                modalHeight = 600;
                modalTitle = 'Modal Designer';
                modalBorderRadius = 12;

                document.getElementById('radiusSlider').value = 12;
                document.getElementById('radiusValue').value = 12;

                init();
            }
        }

        // Click outside export modal to close
        window.onclick = function(event) {
            const modal = document.getElementById('exportModal');
            if (event.target === modal) {
                closeExportModal();
            }
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
