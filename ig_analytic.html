<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Redirecting…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { background:#0b1220; color:#fff; font-family:system-ui,sans-serif;
           display:flex; align-items:center; justify-content:center; height:100vh; }
  </style>
</head>
<body>
  <p>Redirecting…</p>
  <script>
    (function(){
      // 1) Destinations
      const LINKS = {
        main: "https://lalaland.mx",
        yt: "https://www.youtube.com/@yourchannel",
        store: "https://yourstore.example.com",
        portfolio: "https://myname.github.io/portfolio"
      };

      // 2) Parse link key
      const params = new URLSearchParams(location.search);
      const link = (params.get("link") || "main").toLowerCase();
      const dest = LINKS[link] || LINKS.main;

      // 3) Minimal info (avoid anything slow)
      const ua = navigator.userAgent;
      const screenSize = `${screen.width}x${screen.height}`;
      const lang = navigator.language || "unknown";
      const isMobile = /Mobi|Android|iPhone|iPod/i.test(ua);
      const title = `IG Click → ${link}`;
      const topicUrl = "https://ntfy.sh/lalaland-webapp-clicks-track";

      // 4) Beacon first: plain text (most reliable in IG)
      try {
        const text = [
          title,
          `link=${link}`,
          `lang=${lang}`,
          `screen=${screenSize}`,
          `mobile=${isMobile}`,
          `time=${new Date().toISOString()}`
        ].join("\n");
        const ok = navigator.sendBeacon(topicUrl, new Blob([text], { type: "text/plain" }));
      } catch (_) {}

      // 5) Also try keepalive fetch with headers (for pretty Title)
      try {
        fetch(topicUrl, {
          method: "POST",
          keepalive: true,
          headers: {
            "Content-Type": "text/plain",
            "Title": title,
            "Priority": "high",
            // "Tags": "ig,click," + link, // optional
          },
          body: `link=${link} lang=${lang} screen=${screenSize} mobile=${isMobile} time=${new Date().toISOString()}`
        }).catch(()=>{});
      } catch (_) {}

      // 6) Redirect immediately, don't await anything
      location.replace(dest);
    })();
  </script>
</body>
</html>
