<!DOCTYPE html>
<html>
  <head>
    <title>Irregular Clickable Lots with Single Open Label</title>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBTROq6LuvF_IE1r46-T4AeTSV-0d7my8"></script>
    <script>
      // Function to parse the file data
      function parseLotData(text) {
        const lotData = [];
        const lines = text.split("\n");
        let lotCoords = [];
        let lotName = "";

        lines.forEach((line) => {
          const matchLotName = line.match(/^lot\d+/);
          if (matchLotName) {
            if (lotCoords.length > 0) {
              lotData.push({ name: lotName, coords: lotCoords });
            }
            lotName = matchLotName[0];
            lotCoords = [];
          }

          const matchCoordinates = line.match(/lat: ([-\d.]+), lng: ([-\d.]+)/);
          if (matchCoordinates) {
            lotCoords.push({
              lat: parseFloat(matchCoordinates[1]),
              lng: parseFloat(matchCoordinates[2]),
            });
          }
        });

        // Add the last lot to the array
        if (lotCoords.length > 0) {
          lotData.push({ name: lotName, coords: lotCoords });
        }

        return lotData;
      }

      function initMap() {
        const snazzyStyle = [
          // Your style array...
        ];

        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 17.3,
          center: { lat: 25.554195, lng: -100.235521 },
          styles: snazzyStyle,
          mapTypeId: "roadmap"
        });

        // Dynamically fetch the .txt file and parse the data
        fetch('lots.txt')
          .then(response => response.text())  // Read the file content
          .then(text => {
            const lotData = parseLotData(text);  // Parse the lot data

            let openInfoWindow = null;

            // Create polygons based on parsed data
            lotData.forEach((lot, idx) => {
              const polygon = new google.maps.Polygon({
                paths: lot.coords,
                strokeColor: "#00AA00",
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: "#00AA00",
                fillOpacity: 0.35,
                map: map,
                zIndex: 1
              });

              const infoWindow = new google.maps.InfoWindow({
                content: lot.name,
                position: lot.coords[0]
              });

              polygon.addListener("click", () => {
                if (openInfoWindow) {
                  openInfoWindow.close();
                }
                infoWindow.open(map);
                openInfoWindow = infoWindow;
              });

              polygon.addListener("mouseover", () => {
                polygon.setOptions({ fillOpacity: 0.6 });
              });

              polygon.addListener("mouseout", () => {
                polygon.setOptions({ fillOpacity: 0.35 });
              });
            });
          })
          .catch(error => {
            console.error('Error loading or parsing the lot data:', error);
          });
      }
    </script>
  </head>
  <body onload="initMap()">
    <div id="map"></div>
  </body>
</html>
